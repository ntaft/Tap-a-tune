<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Audio Test</title>


    <script>
    // gets file from fileloader

  //   var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  //   var channels = 2;
  //   var frameCount = audioCtx.sampleRate * 1.0;
  //   var myArrayBuffer = audioCtx.createBuffer(channels, frameCount, audioCtx.sampleRate);
  //   document.addEventListener('keypress', () => {
  //     for (var channel = 0; channel < channels; channel++) {
  //       var nowBuffering = myArrayBuffer.getChannelData(channel);
  //       for (var i = 0; i < frameCount; i++) {
  //         nowBuffering[i] = Math.random() * 5 - 2;
  //  }
  // }
  // // Get an AudioBufferSourceNode.
  // // This is the AudioNode to use when we want to play an AudioBuffer
  // var source = audioCtx.createBufferSource();
  // // set the buffer in the AudioBufferSourceNode
  // source.buffer = myArrayBuffer;
  // // connect the AudioBufferSourceNode to the
  // // destination so we can hear the sound
  // source.connect(audioCtx.destination);
  // // start the source playing
  // source.start();
  //
  //   })

  // adapted from various MDN articles on web audio API
let source;
var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function getData(file) {
  source = audioCtx.createBufferSource();
  let request = new XMLHttpRequest();

  request.open('GET', file, true);

  request.responseType = 'arraybuffer';


  request.onload = function() {
    let audioData = request.response;

    audioCtx.decodeAudioData(audioData, function(buffer) {
        let myBuffer = buffer;
        let songLength = buffer.duration;
        source.buffer = myBuffer;
        // source.playbackRate.value = playbackControl.value;
        source.connect(audioCtx.destination);
        //source.loop = true;
      },
      function(e){"Error with decoding audio data" + e.err});
  }
  request.send();
}

    document.addEventListener('keypress', (e) => {
      console.log(e.key);
      switch(e.key) {
        case 'w':
          getData('./sound1');
          break;
        case 'a':
          getData('./sound2');
          break;
        case 's':
          getData('./sound3');
          break;
        case 'd':
          getData('./sound4');
          break;
      }
      // const file = document.getElementById("file-loader").files[0];
      source.start(0);
    })

    </script>
  </head>
  <body>
    <p>input files: </p>
    <input id="file-loader" type="file">
  </body>
</html>
